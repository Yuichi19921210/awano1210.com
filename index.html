<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>サンプルフォーム</title>
  <script src="https://cxppusa1formui01cdnsa01-endpoint.azureedge.net/jpn/FormCapture/FormCapture.bundle.js"></script>
</head>
<body>
  <h2>お問い合わせフォーム</h2>
  <form id="form1">
    <label for="firstname">First Name:</label><br>
    <input type="text" id="firstname" name="firstname" required><br><br>

    <label for="lastname">Last Name:</label><br>
    <input type="text" id="lastname" name="lastname" required><br><br>

    <label for="emailaddress1">Email Address:</label><br>
    <input type="email" id="emailaddress1" name="emailaddress1" required><br><br>

    <button type="submit">送信</button>
  </form>

  <script>
    d365mktformcapture.waitForElement("#form1")
      .then(form => {
        const mappings = [
          {
            FormFieldName: "firstname",
            DataverseFieldName: "firstname",
          },
          {
            FormFieldName: "lastname",
            DataverseFieldName: "lastname",
          },
          {
            FormFieldName: "emailaddress1",
            DataverseFieldName: "emailaddress1",
          },
        ];

        form.addEventListener("submit", (e) => {
          e.preventDefault(); // 👈 忘れず追加！
          const serializedForm = d365mktformcapture.serializeForm(form, mappings);
          const payload = serializedForm.SerializedForm.build();

          const captureConfig = {
            FormId: "d02d38e8-2810-f011-9989-002248f14170",
            FormApiUrl: "https://public-jpn.mkt.dynamics.com/api/v1.0/orgs/d61399ca-e27f-45c5-9da2-958a3475a0b1/landingpageforms"
          };
          d365mktformcapture.submitForm(captureConfig, payload);
        }, true);
      });
  </script>
</body>
</html>
